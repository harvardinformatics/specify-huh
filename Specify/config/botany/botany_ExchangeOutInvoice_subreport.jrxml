<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE jasperReport PUBLIC "//JasperReports//DTD Report Design//EN" "http://jasperreports.sourceforge.net/dtds/jasperreport.dtd">
<jasperReport
		 name="botany_ExchangeOutInvoice_subreport"
		 columnCount="1"
		 printOrder="Vertical"
		 orientation="Portrait"
		 pageWidth="612"
		 pageHeight="792"
		 columnWidth="576"
		 columnSpacing="0"
		 leftMargin="0"
		 rightMargin="0"
		 topMargin="0"
		 bottomMargin="0"
		 whenNoDataType="NoPages"
		 scriptletClass="edu.harvard.huh.specify.config.HUHScriptlet"
		 isTitleNewPage="false"
		 isSummaryNewPage="false">
	<property name="ireport.scriptlethandling" value="0"/>
	<property name="ireport.encoding" value="UTF-8"/>
	<import value="java.util.*"/>
	<import value="net.sf.jasperreports.engine.*"/>
	<import value="net.sf.jasperreports.engine.data.*"/>
	<parameter name="itemnum" class="java.lang.Long" isForPrompting="false"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false"/>
	<queryString>
		<![CDATA[select
       exchangeout.DescriptionOfMaterial as description,
       exchangeout.ExchangeDate          as exchangeDate,
       exchangeout.ExchangeOutID         as exchangeOutID,
       exchangeout.Restrictions          as restrictions,
       exchangeout.Text1                 as forUseByText,
       exchangeout.Text2                 as herbarium,

       (select Title from picklistitem where Value=receiver.Title and PickListID=
         (select PickListID from picklist where Name="AgentTitles")) as receiverTitle,

       receiver.FirstName   as receiverFirstName,
       receiver.Initials    as receiverMiddleInitial,
       receiver.LastName    as receiverLastName,
       receiver.JobTitle    as receiverJobTitle

from exchangeout
     left join agent receiver on receiver.AgentID=exchangeout.SentToOrganizationID

where exchangeout.ExchangeOutID = $P!{itemnum}]]>
	</queryString>
	<field name="description" class="java.lang.String"/>
	<field name="exchangeDate" class="java.sql.Date"/>
	<field name="exchangeOutID" class="java.lang.Long"/>
	<field name="forUseByText" class="java.lang.String"/>
	<field name="herbarium" class="java.lang.String"/>
	<field name="restrictions" class="java.lang.String"/>
	<field name="receiverFirstName" class="java.lang.String"/>
	<field name="receiverJobTitle" class="java.lang.String"/>
	<field name="receiverLastName" class="java.lang.String"/>
	<field name="receiverMiddleInitial" class="java.lang.String"/>
	<field name="receiverTitle" class="java.lang.String"/>
	<variable name="items" class="java.lang.Integer" calculation="Sum"/>
	<variable name="nonSpecimens" class="java.lang.Integer" calculation="Sum"/>
	<variable name="types" class="java.lang.Integer" calculation="Sum"/>
	<background>
		<band isSplitAllowed="true"/>
	</background>
	<title>
		<band isSplitAllowed="true"/>
	</title>
	<pageHeader>
		<band isSplitAllowed="true"/>
	</pageHeader>
	<columnHeader>
		<band height="95" isSplitAllowed="true">
			<staticText>
				<reportElement key="staticText-9" mode="Transparent" x="327" y="27" width="113" height="15" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Top" rotation="None" lineSpacing="Single" markup="none">
					<font fontName="SansSerif" size="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[Term of exchangeout:]]></text>
			</staticText>
			<staticText>
				<reportElement x="339" y="42" width="115" height="20"/>
				<textElement>
					<font fontName="SansSerif" size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Exchange due date:]]></text>
			</staticText>
			<textField pattern="yyyy/MM/dd" isBlankWhenNull="false">
				<reportElement key="textField" x="445" y="42" width="110" height="13"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<font fontName="SansSerif" size="10" isBold="false" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<textFieldExpression class="java.util.Date"><![CDATA[$F{exchangeDate}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-3" x="444" y="26" width="97" height="15"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<font fontName="SansSerif"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[((edu.harvard.huh.specify.config.HUHScriptlet)$P{REPORT_SCRIPTLET}).dateDifference($F{exchangeDate}, $F{exchangeDate})]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="13" y="27" width="28" height="18"/>
				<textElement>
					<font fontName="SansSerif" size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[To: ]]></text>
			</staticText>
			<textField isBlankWhenNull="false">
				<reportElement key="textField" x="37" y="27" width="152" height="13"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<font fontName="SansSerif"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[((edu.harvard.huh.specify.config.HUHScriptlet)$P{REPORT_SCRIPTLET}).buildNameString($F{receiverTitle}, $F{receiverFirstName}, $F{receiverLastName}, $F{receiverMiddleInitial})]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="13" y="42" width="77" height="18"/>
				<textElement>
					<font fontName="SansSerif" size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[For use by:]]></text>
			</staticText>
			<textField isBlankWhenNull="false">
				<reportElement key="textField" x="74" y="42" width="152" height="13"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<font fontName="SansSerif"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{herbarium}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement key="staticText-9" mode="Transparent" x="311" y="14" width="191" height="15" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Top" rotation="None" lineSpacing="Single" markup="none">
					<font fontName="SansSerif" size="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[Transaction Type:    Exchange]]></text>
			</staticText>
			<line>
				<reportElement key="line-5" x="7" y="86" width="567" height="2"/>
				<graphicElement>
					<pen lineWidth="0.5" lineStyle="Solid"/>
				</graphicElement>
			</line>
			<line>
				<reportElement key="line-5" x="7" y="70" width="567" height="2"/>
				<graphicElement>
					<pen lineWidth="0.5" lineStyle="Solid"/>
				</graphicElement>
			</line>
			<staticText>
				<reportElement x="8" y="74" width="634" height="18"/>
				<textElement>
					<font fontName="SansSerif" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Coll.   Taxon                         Comments                                                                                             Gen.   Non-Spec   Types     Received   ]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="124" isSplitAllowed="true">
			<subreport isUsingCache="true">
				<reportElement key="subreport-1" x="1" y="0" width="593" height="98"/>
				<subreportParameter name="itemnum">
					<subreportParameterExpression><![CDATA[$F{exchangeOutID}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<returnValue subreportVariable="itemCount" toVariable="items"/>
				<returnValue subreportVariable="nonSpecimenCount" toVariable="nonSpecimens"/>
				<returnValue subreportVariable="typeCount" toVariable="types"/>
				<subreportExpression class="java.lang.String"><![CDATA[$P{SUBREPORT_DIR} + "botany_ExchangeOutPrep_subreport.jasper"]]></subreportExpression>
			</subreport>
			<line>
				<reportElement key="line-1" x="8" y="113" width="566" height="1"/>
			</line>
		</band>
	</detail>
	<columnFooter>
		<band isSplitAllowed="true"/>
	</columnFooter>
	<pageFooter>
		<band isSplitAllowed="true"/>
	</pageFooter>
	<summary>
		<band isSplitAllowed="true"/>
	</summary>
</jasperReport>
