<?xml version="1.0" encoding="UTF-8"?>
  <statistics>

    <stat name="Top Five Species" display="Pie Chart">
      <chartinfo>
        <title>Top Five Species</title>
        <xaxis>Species</xaxis>
        <yaxis>Number of Specimens</yaxis>
      </chartinfo>
      <sql type="text">
	      <tables>
	        <id>4</id>
	      </tables>
          <![CDATA[select tn,count(tx) as namecnt from (select DT.TaxonId, taxon.TaxonID as tx, taxon.FullName as tn from taxon,determination as DT WHERE DT.CollectionMemberID = COLMEMID AND DT.TaxonId = taxon.TaxonID) as newTable group by tx order by namecnt DESC]]>
      </sql>
      <slice>
        <desc row="1" col="1"/>
        <value row="1" col="2"/>
      </slice>
      <slice>
        <desc row="2" col="1"/>
        <value row="2" col="2"/>
      </slice>
      <slice>
        <desc row="3" col="1"/>
        <value row="3" col="2"/>
      </slice>
      <slice>
        <desc row="4" col="1"/>
        <value row="4" col="2"/>
      </slice>
      <slice>
        <desc row="5" col="1"/>
        <value row="5" col="2"/>
      </slice>
    </stat>

    <stat name="Top 5 Species" display="Bar Chart">
      <chartinfo>
        <title>Top Five Species</title>
      </chartinfo>
      <sql type="text">
	      <tables>
	        <id>4</id>
	      </tables>
          <![CDATA[select tn,count(tx) as namecnt from (select DT.TaxonId, taxon.TaxonID as tx, taxon.Name as tn from taxon,determination as DT WHERE DT.CollectionMemeberID = COLMEMID AND DT.TaxonId = taxon.TaxonID) as newTable group by tx order by namecnt DESC]]>
      </sql>
      <bar>
        <desc row="1" col="1"/>
        <value row="1" col="2"/>
      </bar>
      <bar>
        <desc row="2" col="1"/>
        <value row="2" col="2"/>
      </bar>
      <bar>
        <desc row="3" col="1"/>
        <value row="3" col="2"/>
      </bar>
      <bar>
        <desc row="4" col="1"/>
        <value row="4" col="2"/>
      </bar>
      <bar>
        <desc row="5" col="1"/>
        <value row="5" col="2"/>
      </bar>
    </stat>

    <stat name="ItemsCatalogedLast10Years" display="Bar Chart">
       <chartinfo>
         <title>Items Cataloged Last 10 Years</title>
         <xaxis>Years</xaxis>
         <yaxis>Number of Specimens</yaxis>
       </chartinfo>
       <sql type="custom" name="CatalogedByYearCustomQuery"/>
    </stat>

    <stat name="Temporial Periods" display="Bar Chart">
       <chartinfo>
         <title>Temporial Periods</title>
         <xaxis>Years</xaxis>
         <yaxis>Number of Specimens</yaxis>
       </chartinfo>
      <sql type="custom" name="CatByPrev10YearsCustomQuery"/>
    </stat>

    <stat name="PercentageGrowLast5Years" display="Bar Chart">
       <chartinfo>
         <title>Percentage Grow Last 5 Years</title>
         <xaxis>Years</xaxis>
         <yaxis>Percentage</yaxis>
       </chartinfo>
      <sql type="custom" name="PercentageGrowthCustomQuery"/>
    </stat>

    <stat name="Specimens by Country" display="Bar Chart">
      <chartinfo>
        <title>Top 7 Number of Specimens by Country</title>
      </chartinfo>
      <sql type="text">
	      <tables>
	        <id>1</id>
	        <id>3</id>
	        <id>10</id>
	      </tables>
          <![CDATA[select g.Name as Country, count(g.Name) AS SpecimenCount from (select CollectionObjectID, CO.CollectionMemberID, CE.LocalityID, LOC.GeographyID, GEO.NodeNumber  from collectionobject as CO inner join collectingevent as CE on CE.CollectingEventID = CO.CollectingEventID inner join locality LOC on CE.LocalityID = LOC.LocalityID inner join geography as GEO on GEO.GeographyID = LOC.GeographyID) as COLGEO, geography as g where COLGEO.CollectionMemberID = COLMEMID AND g.rankid = 200 and COLGEO.nodenumber between g.nodenumber and g.HighestChildNodeNumber group by g.Name order by SpecimenCount DESC]]>
      </sql>
      <bar>
        <desc row="1" col="1"/>
        <value row="1" col="2"/>
      </bar>
      <bar>
        <desc row="2" col="1"/>
        <value row="2" col="2"/>
      </bar>
      <bar>
        <desc row="3" col="1"/>
        <value row="3" col="2"/>
      </bar>
      <bar>
        <desc row="4" col="1"/>
        <value row="4" col="2"/>
      </bar>
      <bar>
        <desc row="5" col="1"/>
        <value row="5" col="2"/>
      </bar>
      <bar>
        <desc row="6" col="1"/>
        <value row="6" col="2"/>
      </bar>
      <bar>
        <desc row="7" col="1"/>
        <value row="7" col="2"/>
      </bar>
    </stat>

    <stat name="Specimens by Continent" display="Bar Chart">
      <chartinfo>
        <title>Top 10 Number of Specimens by Continent</title>
      </chartinfo>
      <sql type="text">
	      <tables>
	        <id>1</id>
	        <id>3</id>
	        <id>10</id>
	      </tables>
          <![CDATA[select g.Name as Country, count(g.Name) AS SpecimenCount from (select CollectionObjectID, CE.LocalityID, LOC.GeographyID, GEO.NodeNumber  from collectionobject as CO inner join collectingevent as CE on CE.CollectingEventID = CO.CollectingEventID inner join locality LOC on CE.LocalityID = LOC.LocalityID inner join geography as GEO on GEO.GeographyID = LOC.GeographyID) as COLGEO, geography as g where g.rankid = 100 and COLGEO.nodenumber between g.nodenumber and g.HighestChildNodeNumber group by g.Name order by SpecimenCount DESC]]>
      </sql>
      <bar>
        <desc row="1" col="1"/>
        <value row="1" col="2"/>
      </bar>
      <bar>
        <desc row="2" col="1"/>
        <value row="2" col="2"/>
      </bar>
      <bar>
        <desc row="3" col="1"/>
        <value row="3" col="2"/>
      </bar>
      <bar>
        <desc row="4" col="1"/>
        <value row="4" col="2"/>
      </bar>
      <bar>
        <desc row="5" col="1"/>
        <value row="5" col="2"/>
      </bar>
      <bar>
        <desc row="6" col="1"/>
        <value row="6" col="2"/>
      </bar>
      <bar>
        <desc row="7" col="1"/>
        <value row="7" col="2"/>
      </bar>
     <bar>
        <desc row="8" col="1"/>
        <value row="8" col="2"/>
      </bar>
     <bar>
        <desc row="9" col="1"/>
        <value row="9" col="2"/>
      </bar>
     <bar>
        <desc row="10" col="1"/>
        <value row="10" col="2"/>
      </bar>
    </stat>

    <stat name="ListOnLoan" display="Table">
      <tables>
        <id>5</id>
        <id>52</id>
      </tables>
      <title>Items on Loan</title>
      <sql type="text">
          <![CDATA[Select distinct loan.LoanNumber as LoanNumber, loan.LoanDate, loan.CurrentDueDate, agent.FirstName, agent.LastName,loan.OriginalDueDate, loanpreparation.Quantity, loanpreparation.DescriptionOfMaterial, address.Address, address.City, address.State, address.Country From loan Inner Join loanpreparation ON loan.LoanID =  loanpreparation.LoanID Inner Join loanagent ON loan.LoanID = loanagent.LoanID Inner Join agent ON loanagent.AgentID = agent.AgentID Inner Join address ON agent.AgentID = address.AgentID where loan.loanid in (select loanid from loan where (IsClosed = false or IsClosed is null)) group by LoanNumber]]>
      </sql>
    </stat>

    <stat name="OverdueLoansList" display="Table">
      <title>Overdue Loans</title>
      <sql type="text">
	      <tables>
	        <id>5</id>
	        <id>52</id>
	      </tables>      
          <![CDATA[Select distinct loan.LoanNumber as LoanNumber, loan.LoanDate, loan.CurrentDueDate, agent.FirstName, agent.LastName, loan.loanid, loan.OriginalDueDate, loanpreparation.Quantity, loanpreparation.DescriptionOfMaterial, address.Address, address.City, address.State, address.Country From loan Inner Join loanpreparation ON loan.LoanID =  loanpreparation.LoanID Inner Join loanagent ON loan.LoanID = loanagent.LoanID Inner Join agent ON loanagent.AgentID = agent.AgentID Inner Join address ON agent.AgentID = address.AgentID where loan.loanid in (select loanid from loan where (not  (currentduedate is null)) and (IsClosed = false or IsClosed is null) and datediff(CURDATE(), currentduedate) > 0)  group by LoanNumber]]>
      </sql>
    </stat>

    <stat name="CatalogedLast7DaysDetail" display="Table">
      <title>Cataloged Last 7 Days</title>
      <sql type="text">
	      <tables>
	        <id>1</id>
	      </tables>      
          <![CDATA[Select collectionobject.CatalogNumber,taxon.Name,collectionobject.TimestampCreated From collectionobject Inner Join determination ON collectionobject.CollectionObjectID = determination.CollectionObjectID Inner Join taxon ON determination.TaxonID = taxon.TaxonID where DATE_SUB(CURDATE(), INTERVAL 7 DAY) <= collectionobject.TimestampCreated]]>
      </sql>
    </stat>

    <stat name="CatalogedLastMonth" display="Table">
      <title>Cataloged Last Month</title>
      <sql type="text">
	      <tables>
	        <id>1</id>
	      </tables>      
          <![CDATA[Select collectionobject.CatalogNumber,taxon.Name,collectionobject.TimestampCreated From collectionobject Inner Join determination ON collectionobject.CollectionObjectID = determination.CollectionObjectID Inner Join taxon ON determination.TaxonID = taxon.TaxonID where DATE_SUB(CURDATE(), INTERVAL 1 MONTH) <= collectionobject.TimestampCreated]]>
      </sql>
    </stat>

    <stat name="CatalogedLastYear" display="Table">
      <title>Cataloged Last Year</title>
      <sql type="text">
	      <tables>
	        <id>1</id>
	      </tables>      
          <![CDATA[Select collectionobject.CatalogNumber,taxon.Name,collectionobject.TimestampCreated From collectionobject Inner Join determination ON collectionobject.CollectionObjectID = determination.CollectionObjectID Inner Join taxon ON determination.TaxonID = taxon.TaxonID where DATE_SUB(CURDATE(), INTERVAL 1 YEAR) <= collectionobject.TimestampCreated]]>
      </sql>
    </stat>

    <stat name="OverdueLookup" display="Table">
      <title>Loan Overdue</title>
      <sql type="text">
	      <tables>
	        <id>5</id>
	        <id>8</id>
	        <id>52</id>
	        <id>53</id>
	      </tables>      
          <![CDATA[Select distinct loan.LoanNumber as LoanNumber, loan.LoanDate, loan.CurrentDueDate, agent.FirstName, agent.LastName,loan.OriginalDueDate, loanpreparation.Quantity, loanpreparation.DescriptionOfMaterial, address.Address, address.City, address.State, address.Country From loan Inner Join loanpreparation ON loan.LoanID =  loanpreparation.LoanID Inner Join loanagent ON loan.LoanID = loanagent.LoanID Inner Join agent ON loanagent.AgentID = agent.AgentID Inner Join address ON agent.AgentID = address.AgentID where loan.loanid = %s]]>
      </sql>
    </stat>

    <!-- ********************* -->
    <!--  Accession Statistics -->
    <!-- ********************* -->
      <stat name="AccessionByDivision" display="Bar Chart">
          <chartinfo>
              <title>Top 5 Accessions By Division</title>
          </chartinfo>
          <sql type="text">
		      <tables>
		        <id>7</id>
		      </tables>      
              <![CDATA[select Text1, count(AccessionId) AS DivCount from accession where Text1 is not null group by Text1 order by DivCount desc]]>
          </sql>
          <bar>
              <desc row="1" col="1"/>
              <value row="1" col="2"/>
          </bar>
          <bar>
              <desc row="2" col="1"/>
              <value row="2" col="2"/>
          </bar>
          <bar>
              <desc row="3" col="1"/>
              <value row="3" col="2"/>
          </bar>
          <bar>
              <desc row="4" col="1"/>
              <value row="4" col="2"/>
          </bar>
          <bar>
              <desc row="5" col="1"/>
              <value row="5" col="2"/>
          </bar>
      </stat>


      <stat name="Accession" display="Form" viewset="Common" view="Accession" mode="view">
	      <title>Permits Expiring This Year</title>
          <sql type="text">
		      <tables>
		        <id>7</id>
		      </tables>
              <![CDATA[select * From accession where accession.AccessionID = %s]]>
          </sql>
      </stat>

      <stat name="CITESPermitsExpireThisYear" display="Form" viewset="Common" view="PermitForAccessions" mode="view">
	      <title>Permits Expiring This Year</title>
          <sql type="text">
		      <tables>
		        <id>6</id>
		      </tables>
              <![CDATA[select permit.PermitID, permit.PermitNumber,permit.IssuedDate,permit.StartDate,
permit.EndDate,permit.RenewalDate,permit.Type From permit where permit.PermitID = %s]]>
          </sql>
      </stat>

      <stat name="NonCITESPermitsExpireThisYear" display="Form" viewset="Common" view="PermitForAccessions" mode="view">
          <view mode="display">Permit</view>
          <title>Non-CITES Permits Expiring This Year</title>
          <sql type="text">
		      <tables>
		        <id>6</id>
		      </tables>
              <![CDATA[select permit.PermitID, permit.PermitNumber,permit.IssuedDate,permit.StartDate,
permit.EndDate,permit.RenewalDate,permit.Type From permit where permit.PermitID = %s]]>
          </sql>
      </stat>


      <!-- ********************* -->
      <!--  Web Statistics -->
      <!-- ********************* -->

<!--
      <stat name="Web Stats Visitors" display="Bar Chart">
          <chartinfo>
              <title>Web Stats Visitors</title>
              <xaxis>Months</xaxis>
              <yaxis>Number of Visitors</yaxis>
          </chartinfo>
          <sql type="custom" name="WebStatsVisitorsCustomQuery"/>
      </stat>

      <stat name="Web Stats Top 5 Taxon" display="Bar Chart">
          <chartinfo>
              <title>Web Stats Top 5 Taxon</title>
              <xaxis>Species</xaxis>
              <yaxis>Number of Hits</yaxis>
          </chartinfo>
          <sql type="custom" name="WebStatsTaxonCustomQuery"/>
      </stat>
  -->

  </statistics>
