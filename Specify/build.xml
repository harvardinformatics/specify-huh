<?xml version="1.0"?>
<project name="Specify 6.0 Build File" basedir=".">

	<!-- Set up properties containing important project directories -->
	
	<property name="source.root" value="src" />
	
	<property name="compile.src.root" value="compile-src" />
	<property name="compile.dst.root" value="compile-dst" />
	
	<property name="class.root" value="bin" />
	
	<property name="installer.dir" value="InstallerFiles" />
	<property name="lib.dir" value="libs" />
	<property name="hibernatelib.dir" value="hibernate_libs" />
	<property name="externallib.dir" value="external_libs" />
	<property name="ireport.dir" value="iReportLibs" />
	<property name="system.dep.libs.dir" value="system_dep_libs" />
	<property name="hibernate.properties" value="hibernate.properties" />
	<property name="hibernate.cfg" value="hibernate.cfg.xml" />
	<property name="dir.dest" value="dest" />
	<property name="hibernate.generated.code.destdir" value="generated-src" />

	<property name="data.dir" value="data" />

	<!-- Needed for building help search index -->
	<property name ="javahelp-home" value="/home/specify/jh2.0" />
	<property name ="javahelp-home-mac" value="/Applications/jh2.0" />
	
	<!-- Needed for Packing on the Mac -->
	<property name="packaging" value="packaging" />
	<property name="app.name" value="Specify" />
	<property name="jar.name" value="specify" />
	<property name="dist-mac" value="mac-dist" />


	<!-- Needed for Packing on the Windows -->
	<property name="dist-win" value="win-dist" />

	<!-- Needed for Packing on the Linux -->
	<property name="dist-linux" value="linux-dist" />

	<!-- Set up the class path for compilation and execution -->
	<path id="project.class.path">
		
		<!-- Include jars in the project library directory -->
		<fileset dir="${hibernatelib.dir}">
			<include name="**/*.jar" />
		</fileset>
		
	    <fileset dir="${lib.dir}">
			<include name="**/*.jar" />
		</fileset>

		<!-- Include our own classes, of course -->
		<pathelement location="specify.jar"/>
		
	</path>

	<!-- Prepare for Windows and Linux Compile -->
	<target name="dist-prepare" description="Sets up build structures for Non Mac Platforms">
		
		<mkdir dir="${compile.dst.root}" />
		<mkdir dir="${compile.src.root}" />
		
		<copy todir="${compile.src.root}">
			<fileset dir="${source.root}">
				<include name="**/*.properties" />
				<include name="**/*.java" />
			</fileset>
		</copy>
		
	</target>

	<!-- Prepare for Mac Compile -->
	<target name="dist-prepare-mac" description="Sets up build structures for Mac-Dist">
		
		<mkdir dir="${compile.dst.root}" />
		<mkdir dir="${compile.src.root}" />
		
		<copy todir="${compile.src.root}">
			<fileset dir="${source.root}">
				<include name="**/*.properties" />
				<exclude name="**/AttachmentUtils.java" />
				<include name="**/*.java" />
			</fileset>
		</copy>
		
	</target>

	<!-- Compile the java source of the project Windows and Linux -->
	<target name="dist-compile" depends="dist-prepare" description="Compiles all Java classes for Mac-Dist">
		
		<javac srcdir="${compile.src.root}" destdir="${compile.dst.root}" debug="on" optimize="off" deprecation="on">
			<classpath refid="project.class.path" />
		</javac>
		
	</target>
	
	<!-- Compile the java source of the project Mac-->
	<target name="dist-compile-mac" depends="dist-prepare-mac" description="Compiles all Java classes for Mac-Dist">
		
		<javac srcdir="${compile.src.root}" destdir="${compile.dst.root}" debug="on" optimize="off" deprecation="on">
			<classpath refid="project.class.path" />
		</javac>
	</target>
	
	<!-- Jar up compiled classes -->
	<target name="dist-jar" depends="">
		
		<jar destfile="${jar.name}.jar">
			<fileset dir="${class.root}">
				<include name="**/*.class" />
				<include name="**/*.properties" />
				<include name="**/*.xml" />
				<include name="**/images/**/*.*" />
			</fileset>
		</jar>

	</target>

	<!-- Jar up compiled classes -->
	<target name="dist-jar-mac" depends="">
		
		<jar destfile="${jar.name}.jar">
			<fileset dir="${class.root}">
				<include name="**/*.class" />
				<include name="**/*.properties" />
				<include name="**/*.xml" />
				<include name="**/images/**/*.*" />
			</fileset>
	    </jar>
	</target>

	<target name="dist-jar-mac-ls" depends="">
		
		<jar destfile="${jar.name}.jar">
			<fileset dir="${class.root}">
				<include name="**/*.class" />
				<include name="**/*.properties" />
				<include name="**/*.xml" />
				<exclude name="**/images/**/*.*" />
			</fileset>
	    </jar>
	</target>
	
	<!-- Jar Clean Up -->
	<target name="clean-jar">
		<delete file="${jar.name}.jar" />
	</target>
	
	<!-- *************************************************************
	     Mac Common Components Build
	     ************************************************************* -->
	
	<target name="installer-linux" depends="">
	    <antcall target="installer-base"/>
		<copy file="./system_dep_libs/non-mac-application-adapter.jar" todir="${installer.dir}" />
		<!--
	    <antcall target="build-help-index"/>
	    <antcall target="build-help-fulltext-linux"/>
	    -->
    </target>
	
	<target name="installer-mac" depends="">
	    <antcall target="installer-base"/>
		<!--
	    <antcall target="build-help-index"/>
	    <antcall target="build-help-fulltext-mac"/>
	    -->
    </target>
	
	<target name="installer-base" depends="">
		
		<delete dir="${installer.dir}"/>
		<mkdir dir="${installer.dir}" />
		<mkdir dir="${installer.dir}/demo_files" />
		
		<antcall target="clean-jar"/>
		<antcall target="dist-jar-mac"/>
		
		<!-- Copy config dir -->
		<copy todir="${installer.dir}/config">
			<fileset dir="config">
				<exclude name="**/*.svn" />
			</fileset>
		</copy>
        <copy todir="${installer.dir}/hibernate_libs">
			<fileset dir="hibernate_libs">
				<exclude name="**/*.svn" />
			</fileset>
		</copy>
        <copy todir="${installer.dir}/iReportLibs">
			<fileset dir="iReportLibs">
				<exclude name="**/*.svn" />
			</fileset>
		</copy>
        <copy todir="${installer.dir}/libs">
			<fileset dir="libs">
                <exclude name="**/*.svn" />
                <exclude name="**/derby.jar" />
			</fileset>
		</copy>
		
		<!-- Copy Help -->
		<copy todir="${installer.dir}/help">
			<fileset dir="help">
				<include name="**/*" />
				<exclude name="**/.svn" />
				<exclude name="**/*.psd" />
			</fileset>
		</copy>
		
		<copy file="${jar.name}.jar" todir="${installer.dir}" />
		
		<copy file="${source.root}/edu/ku/brc/specify/images/specify16.png" todir="${installer.dir}/images" />
		<copy file="${source.root}/edu/ku/brc/specify/images/specify32.png" todir="${installer.dir}/images" />
		
		<copy file="${source.root}/edu/ku/brc/specify/images/spireport32.png" todir="${installer.dir}/images" />
		<copy file="${source.root}/edu/ku/brc/specify/images/spireport16.png" todir="${installer.dir}/images" />

		<copy file="${source.root}/edu/ku/brc/specify/images/spbackup32.png" todir="${installer.dir}/images" />
		<copy file="${source.root}/edu/ku/brc/specify/images/spbackup16.png" todir="${installer.dir}/images" />

		<copy file="${source.root}/edu/ku/brc/specify/images/spwizard32.png" todir="${installer.dir}/images" />
		<copy file="${source.root}/edu/ku/brc/specify/images/spwizard16.png" todir="${installer.dir}/images" />

		<copy file="${source.root}/edu/ku/brc/specify/images/spbuilder32.png" todir="${installer.dir}/images" />
		<copy file="${source.root}/edu/ku/brc/specify/images/spbuilder16.png" todir="${installer.dir}/images" />

		<copy file="${source.root}/edu/ku/brc/specify/images/spstatistics32x32.png" todir="${installer.dir}/images" />
		<copy file="${source.root}/edu/ku/brc/specify/images/spstatistics16x16.png" todir="${installer.dir}/images" />	
		
		<copy file="${source.root}/edu/ku/brc/specify/images/specify128.ico" todir="${installer.dir}/images" />
		<copy file="${source.root}/edu/ku/brc/specify/images/spbackup128.ico" todir="${installer.dir}/images" />
		<copy file="${source.root}/edu/ku/brc/specify/images/spbuilder128.ico" todir="${installer.dir}/images" />
		<copy file="${source.root}/edu/ku/brc/specify/images/spireport128.ico" todir="${installer.dir}/images" />
		<copy file="${source.root}/edu/ku/brc/specify/images/spstatistics128.ico" todir="${installer.dir}/images" />
		<copy file="${source.root}/edu/ku/brc/specify/images/spwizard128.ico" todir="${installer.dir}/images" />
				
		
		<!-- <copy file="${source.root}/edu/ku/brc/specify/images/SpecifyBigSplash.png" todir="${installer.dir}" /> -->
		<copy file="packaging/specify.icns" todir="${installer.dir}/images" />
		<copy file="packaging/spwizard.icns" todir="${installer.dir}/images" />
		<copy file="packaging/backuprestore.icns" todir="${installer.dir}/images" />
		<copy file="packaging/spireports.icns" todir="${installer.dir}/images" />
		<copy file="packaging/spbuilder.icns" todir="${installer.dir}/images" />
		<copy file="packaging/statistics.icns" todir="${installer.dir}/images" />
		
		<copy file="packaging/readme.html" todir="${installer.dir}" />
		<copy file="packaging/license_agreement.html" todir="${installer.dir}" />
		<copy file="./packaging/SpecifyBigSplashBordered.png" todir="${installer.dir}" />
		<rename src="${installer.dir}/SpecifyBigSplashBordered.png" dest="${installer.dir}/SpecifyBigSplash.png"/>
        <copy file="./demo_files/Stratigraphy.csv" todir="${installer.dir}/config" />
        <copy file="./demo_files/Stratigraphy.csv" todir="${installer.dir}/config" />
		<copy file="./demo_files/topbrc4.jpg" todir="${installer.dir}/demo_files" />
        <copy file="./demo_files/topbrc195x68.png" todir="${installer.dir}/demo_files" />
        <copy file="./demo_files/Geography.xls" todir="${installer.dir}/demo_files" />
        <copy file="./demo_files/chronostrat_tree.xls" todir="${installer.dir}/demo_files" />
		
		<!-- Copy of Wizard Taxon Information -->
		<copy todir="${installer.dir}/demo_files/taxonomy">
			<fileset dir="demo_files/taxonomy">
				<include name="**/*" />
			</fileset>
		</copy>
		
		
	</target>
	
	<target name="installer-updater" depends="">
		
		<delete dir="UpdaterInstall"/>
		<mkdir dir="UpdaterInstall" />
		
		<antcall target="dist-jar"/>
		
        <copy todir="UpdaterInstall/libs">
			<fileset dir="libs">
				<exclude name="**/*.svn" />
			</fileset>
		</copy>
		<copy file="${jar.name}.jar" todir="UpdaterInstall" />
    </target>
	

		
	<!-- *************************************************************
	     Mac Common Components Build
	     ************************************************************* -->
	<target name="dist-mac-common" depends="">
		
		<mkdir dir="${dist-mac}" />
		<mkdir dir="${appdir}" />
		<mkdir dir="${appdir}/Contents" />
		<mkdir dir="${appdir}/Contents/MacOS" />
		<mkdir dir="${appdir}/Contents/Resources" />
		<mkdir dir="${appdir}/Contents/Resources/Java" />
		<mkdir dir="${appdir}/Contents/Resources/Java/src" />
		<mkdir dir="${appdir}/Contents/Resources/Java/config" />
		<mkdir dir="${appdir}/Contents/Resources/Java/demo_files" />
		<mkdir dir="${appdir}/Contents/Resources/Java/system_dep_libs" />
		<mkdir dir="${appdir}/Contents/Resources/Java/system_dep_libs/mac" />
		
		<!-- Copy Application Stub Compile the java source of the project -->
		<copy file="${packaging}/JavaApplicationStub" todir="${appdir}/Contents/MacOS" />
		<exec command="chmod 755 ${appdir}/Contents/MacOS/JavaApplicationStub" />

		<!-- Copy config dir -->
		<copy todir="${appdir}/Contents/Resources/Java/config">
			<fileset dir="config">
				<exclude name="**/*.svn" />
			</fileset>
		</copy>
		
		<!-- Copy the main app jar -->
		<copy file="${jar.name}.jar" todir="${appdir}/Contents/Resources/Java" />

		<!-- Copy Icons -->
		<copy file="${packaging}/specify.icns" todir="${appdir}/Contents/Resources" />

		<!-- Libraries / Jars -->
		<copy todir="${appdir}/Contents/Resources/Java">
			<fileset dir="libs">
				<include name="*.jar" />
				<exclude name="**/json-lib.jar" />
				<exclude name="**/ezmorph.jar" />
			</fileset>
			<fileset dir="${hibernatelib.dir}">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${ireport.dir}">
				<include name="*.jar" />
			</fileset>
		</copy>

		<!-- Tell OS the dir is an App -->
		<exec command="/Developer/Tools/SetFile -a B ${appdir}" />

		<!-- Copy Help -->
		<copy todir="${appdir}/Contents/Resources/Java/help">
			<fileset dir="help">
				<exclude name="**/.svn" />
				<exclude name="**/*.psd" />
			</fileset>
		</copy>
		
	    <antcall target="build-help-index"/>
	    <antcall target="build-help-fulltext-mac"/>

    </target>
	
	<!-- *************************************************************
	     Mac Distribution for the iReports4Specify
	     ************************************************************* -->
	<target name="dist-mac-irep" depends="">
		
		<property name="appdir" value="${dist-mac}/iReports4Specify.app" />
		<property name="derby.data.path" value="${dist-mac}" />
	
		<delete dir="${dist-mac}/iReports4Specify.app"/>
		
		<antcall target="clean-jar"/>
		
		<antcall target="dist-jar-mac"/>
		<antcall target="dist-mac-common"/>
		
		<!-- Copy and Rename Info List -->
		<copy file="${packaging}/ireports/Info.plist" todir="${appdir}/Contents" />
		
		<!-- Copy and Rename PkgInfo -->
		<copy file="${packaging}/ireports/PkgInfo" todir="${appdir}/Contents" />
		
		<!-- Copy Icons -->
		<copy file="${packaging}/ireports/ireports.icns" todir="${appdir}/Contents/Resources" />
		<delete file="${appdir}/Contents/Resources/specify.icns"/>	
		
		<!-- 
		<delete file="${appdir}/Contents/Resources/Java/iReport.jar"/>
		
		<rename src="${appdir}/Contents/Resources/Java/iReportMac.jar" dest="${appdir}/Contents/Resources/Java/iReport.jar"/>
		-->	
		<!-- <rename src="${appdir}/Contents/Resources/ireports.icns" dest="${appdir}/Contents/Resources/specifybldr.icns"/> -->
		<!-- <rename src="${appdir}/Contents/Resources/specify.icns" dest="${appdir}/Contents/Resources/specifybldr.icns"/> -->
		
	</target>
	
		
	<!-- *************************************************************
	     Mac Distribution for the Builder
	     ************************************************************* -->
	<target name="dist-mac-bld" depends="">
		
		<property name="appdir" value="${dist-mac}/SpecifyBuilder.app" />
		<property name="derby.data.path" value="${dist-mac}" />

		<antcall target="clean-jar"/>
		
		<antcall target="dist-jar-mac"/>
		<antcall target="dist-mac-common"/>
		
		<!-- Copy and Rename Info List -->
		<copy file="${packaging}/builder/Info.plist" todir="${appdir}/Contents" />
		
		<!-- Copy and Rename PkgInfo -->
		<copy file="${packaging}/builder/PkgInfo" todir="${appdir}/Contents" />
		
		<!-- Copy Icons -->
		<!-- <copy file="${packaging}/builder/specifybldr.icns" todir="${appdir}/Contents/Resources" /> -->
		<rename src="${appdir}/Contents/Resources/specify.icns" dest="${appdir}/Contents/Resources/specifybldr.icns"/>
		
		<!-- Copy Stratigraphy.csv -->
		<copy file="demo_files/Stratigraphy.csv" todir="${appdir}/Contents/Resources/Java/config" />

	</target>

	<!-- *************************************************************
	    Mac Distribution (Main Specify Application)
	    ************************************************************* -->
	<target name="dist-mac" depends="">
		
		<property name="appdir" value="${dist-mac}/${app.name}.app" />
		<property name="derby.data.path" value="${dist-mac}" />

		<antcall target="clean-jar"/>
		<delete dir="${dist-mac}"/>
		
		<antcall target="dist-jar-mac"/>
		<antcall target="dist-mac-common"/>

		<!-- Copy info list -->
		<copy file="${packaging}/Info.plist" todir="${appdir}/Contents" />

		<!-- Copy PkgInfo -->
		<copy file="${packaging}/PkgInfo" todir="${appdir}/Contents" />

		<!-- Copy demo_files dir -->
		<copy todir="${appdir}/Contents/Resources/Java/demo_files">
			<fileset dir="demo_files">
				<exclude name="**/.svn" />
				<exclude name="**/.csv" />
				<exclude name="**/.jrxml" />
				<include name="**/topbrc195x68.png" />
			</fileset>
		</copy>
		
		<!-- Testing Alt Help 
		<property name="alt.help.img.dir" value="AltHelpImages/Windows"/>
		<antcall target="copy-alt-help-images"/> -->

		<!-- Demo Files -->
		<copy file="demo_files/workbench/FishCollectingTrip.csv" todir="${dist-mac}/examples" />
		<copy file="demo_files/workbench/JohsonCountyTrip.csv" todir="${dist-mac}/examples" />
	    <copy file="demo_files/workbench/SaipanTrip.xls" todir="${dist-mac}/examples" />
	    <copy file="demo_files/Reports/ImportExample.jrxml" todir="${dist-mac}/examples" />
		
	</target>
	
	
	<!-- *************************************************************
	     Mac Schema Localizer Application Build
	     ************************************************************* -->
	<target name="dist-mac-sl" depends="">
		
		<property name="appdir" value="${dist-mac}/SpecifySchema.app" />
		<property name="derby.data.path" value="${dist-mac}/DerbyDatabases" />
		
		<antcall target="clean-jar"/>
		<antcall target="dist-jar-mac-ls"/> <!-- No IMages -->
		<antcall target="dist-mac-common"/>
		
		<!-- Copy and Rename Info List -->
		<copy file="${packaging}/schemaloc/Info.plist" todir="${appdir}/Contents" />
		
		<!-- Copy and Rename PkgInfo -->
		<copy file="${packaging}/schemaloc/PkgInfo" todir="${appdir}/Contents" />
		
	</target>
	
	<!-- *************************************************************
	     Mac SpecifyDBInit Application Build
	     ************************************************************* -->
	<target name="dist-mac-db-init" depends="">
		
		<property name="appdir" value="${dist-mac}/SpecifyDBInit.app" />
		<property name="derby.data.path" value="${dist-mac}/DerbyDatabases" />
		
		<antcall target="clean-jar"/>
		<antcall target="dist-jar-mac"/>
		<antcall target="dist-mac-common"/>
		
		<!-- Copy and Rename Info List -->
		<copy file="${packaging}/specifydbinit/Info.plist" todir="${appdir}/Contents" />
		
		<!-- Copy and Rename PkgInfo -->
		<copy file="${packaging}/specifydbinit/PkgInfo" todir="${appdir}/Contents" />
		
	</target>
	

	<!-- *************************************************************
	     Mac Builds All the Mac Applications
	     ************************************************************* -->
	<target name="dist-mac-all" depends="">
		<antcall target="dist-mac"/>
		<antcall target="dist-mac-sl"/>
		<antcall target="dist-mac-bld"/>
		<antcall target="dist-mac-db-init"/>
		<antcall target="dist-mac-irep"/>
	</target>
	
	<!-- *************************************************************
	    Mac Distribution OLD (Main Specify Application)
	    ************************************************************* -->
	<target name="dist-mac-old" depends="">
		
		<property name="appdir" value="${dist-mac}/${app.name}.app" />
		<property name="derby.data.path" value="${dist-mac}" />
		
		<antcall target="clean-jar"/>
		<antcall target="dist-jar-mac"/>
		<antcall target="dist-mac-clean"/>
		
		<antcall target="build-empty-derby-db"/>
				
		<mkdir dir="${dist-mac}" />
		<mkdir dir="${appdir}" />
		<mkdir dir="${appdir}/Contents" />
		<mkdir dir="${appdir}/Contents/MacOS" />
		<mkdir dir="${appdir}/Contents/Resources" />
		<mkdir dir="${appdir}/Contents/Resources/Java" />
		<mkdir dir="${appdir}/Contents/Resources/Java/config" />
		<mkdir dir="${appdir}/Contents/Resources/Java/demo_files" />

		<!-- Copy Application Stub Compile the java source of the project -->
		<copy file="${packaging}/JavaApplicationStub" todir="${appdir}/Contents/MacOS" />
		<exec command="chmod 755 ${appdir}/Contents/MacOS/JavaApplicationStub" />

		<!-- Copy info list -->
		<copy file="${packaging}/Info.plist" todir="${appdir}/Contents" />

		<!-- Copy PkgInfo -->
		<copy file="${packaging}/PkgInfo" todir="${appdir}/Contents" />

		<!-- Copy demo_files dir -->
		<copy todir="${appdir}/Contents/Resources/Java/demo_files">
			<fileset dir="demo_files">
				<exclude name="**/.svn" />
				<exclude name="**/.csv" />
				<exclude name="**/.jrxml" />
				<include name="**/topbrc195x68.png" />
			</fileset>
		</copy>
		
		<!-- Copy config dir -->
		<copy todir="${appdir}/Contents/Resources/Java/config">
			<fileset dir="config">
				<exclude name="**/*.svn" />
			</fileset>
		</copy>
		
		<!-- Copy the main app jar -->
		<copy file="${jar.name}.jar" todir="${appdir}/Contents/Resources/Java" />

		<!-- Copy Icons -->
		<copy file="${packaging}/specify.icns" todir="${appdir}/Contents/Resources" />

		<copy todir="${appdir}/Contents/Resources/Java">
			<fileset dir="libs">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${hibernatelib.dir}">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${ireport.dir}">
				<include name="iReport.jar" />
			</fileset>
		</copy>

		<!-- Tell OS the dir is an App -->
		<exec command="/Developer/Tools/SetFile -a B ${appdir}" />
		

		<!-- Copy Help -->
		<copy todir="${appdir}/Contents/Resources/Java/help">
			<fileset dir="help">
				<exclude name="**/.svn" />
			</fileset>
		</copy>
		
		<antcall target="build-help-index"/>
		<antcall target="build-help-fulltext-mac"/>
		
		<!-- Testing Alt Help 
		<property name="alt.help.img.dir" value="AltHelpImages/Windows"/>
		<antcall target="copy-alt-help-images"/> -->

		<!-- Demo Files -->
		<copy file="demo_files/workbench/FishCollectingTrip.csv" todir="${dist-mac}/examples" />
		<copy file="demo_files/workbench/JohsonCountyTrip.csv" todir="${dist-mac}/examples" />
	    <copy file="demo_files/workbench/SaipanTrip.xls" todir="${dist-mac}/examples" />
		<copy file="demo_files/Reports/ImportExample.jrxml" todir="${dist-mac}/examples" />
	</target>

		
	<!-- *************************************************************
	     Mac WorkBench Application Build
	     ************************************************************* -->
	<target name="dist-mac-wb" depends="">
		
		<property name="appdir" value="${dist-mac}/${app.name}.app" />
		<property name="derby.data.path" value="${dist-mac}/DerbyDatabases" />
		
		<antcall target="clean-jar"/>
		<antcall target="dist-jar-mac"/>
		<antcall target="dist-mac-clean"/>
		
		<!--
		<antcall target="build-empty-derby-db"/>
		-->
		<mkdir dir="${dist-mac}" />
		<mkdir dir="${appdir}" />
		<mkdir dir="${appdir}/Contents" />
		<mkdir dir="${appdir}/Contents/MacOS" />
		<mkdir dir="${appdir}/Contents/Resources" />
		<mkdir dir="${appdir}/Contents/Resources/Java" />
		<mkdir dir="${appdir}/Contents/Resources/Java/config" />

		<!-- Copy Application Stub Compile the java source of the project -->
		<copy file="${packaging}/JavaApplicationStub" todir="${appdir}/Contents/MacOS" />
		<exec command="chmod 755 ${appdir}/Contents/MacOS/JavaApplicationStub" />

		<!-- Copy info list -->
		<copy file="${packaging}/WBInfo.plist" todir="${appdir}/Contents" />
		<rename src="${appdir}/Contents/WBInfo.plist" dest="${appdir}/Contents/Info.plist"/>
		
		<!-- Copy PkgInfo -->
		<copy file="${packaging}/PkgInfo" todir="${appdir}/Contents" />

		<!-- Copy config dir -->
		<copy todir="${appdir}/Contents/Resources/Java/config">
			<fileset dir="config">
				<exclude name="**/*.svn" />
			</fileset>
		</copy>
		
		<!-- Copy the main app jar -->
		<copy file="${jar.name}.jar" todir="${appdir}/Contents/Resources/Java" />

		<!-- Copy Icons -->
		<copy file="${packaging}/specify.icns" todir="${appdir}/Contents/Resources" />

		<copy todir="${appdir}/Contents/Resources/Java">
			<fileset dir="libs">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${hibernatelib.dir}">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${ireport.dir}">
				<include name="iReport.jar" />
			</fileset>
		</copy>

		<!-- Tell OS the dir is an App -->
		<exec command="/Developer/Tools/SetFile -a B ${appdir}" />
		

		<!-- Copy Help -->
		<copy todir="${appdir}/Contents/Resources/Java/help">
			<fileset dir="help">
				<exclude name="**/.svn" />
			</fileset>
		</copy>

		<!-- Demo Files -->
		<copy file="demo_files/workbench/FishCollectingTrip.csv" todir="${dist-mac}/examples" />
		<copy file="demo_files/workbench/JohsonCountyTrip.csv" todir="${dist-mac}/examples" />
	    <copy file="demo_files/workbench/SaipanTrip.xls" todir="${dist-mac}/examples" />

	</target>

	<!-- *************************************************************
	     Mac Schema Localizer Application Build
	     ************************************************************* -->
	<target name="dist-mac-sl-old" depends="">
		
		<property name="appdir" value="${dist-mac}/SpecifySchema.app" />
		<property name="derby.data.path" value="${dist-mac}/DerbyDatabases" />
		
		<antcall target="clean-jar"/>
		<antcall target="dist-jar-mac-ls"/>
		<antcall target="dist-mac-clean"/>
		
		<!--
		<antcall target="build-empty-derby-db"/>
		-->
		<mkdir dir="${dist-mac}" />
		<mkdir dir="${appdir}" />
		<mkdir dir="${appdir}/Contents" />
		<mkdir dir="${appdir}/Contents/MacOS" />
		<mkdir dir="${appdir}/Contents/Resources" />
		<mkdir dir="${appdir}/Contents/Resources/Java" />
		<mkdir dir="${appdir}/Contents/Resources/Java/config" />

		<!-- Copy Application Stub Compile the java source of the project -->
		<copy file="${packaging}/JavaApplicationStub" todir="${appdir}/Contents/MacOS" />
		<exec command="chmod 755 ${appdir}/Contents/MacOS/JavaApplicationStub" />

		<!-- Copy info list -->
		<copy file="${packaging}/SLInfo.plist" todir="${appdir}/Contents" />
		<rename src="${appdir}/Contents/SLInfo.plist" dest="${appdir}/Contents/Info.plist"/>
		
		<!-- Copy PkgInfo -->
		<copy file="${packaging}/PkgInfo" todir="${appdir}/Contents" />

		<!-- Copy config dir -->
		<copy todir="${appdir}/Contents/Resources/Java/config">
			<fileset dir="config">
				<exclude name="**/*.svn" />
				<exclude name="**/fish/*" />
				<exclude name="**/birds/*" />
				<exclude name="**/backstop/*" />
				<exclude name="**/accessions/*" />
				<exclude name="**/insect/*" />
			</fileset>
		</copy>
		
		<!-- Copy the main app jar -->
		<copy file="${jar.name}.jar" todir="${appdir}/Contents/Resources/Java" />

		<!-- Copy Icons -->
		<copy file="${packaging}/specify.icns" todir="${appdir}/Contents/Resources" />

		<copy todir="${appdir}/Contents/Resources/Java">
			<fileset dir="libs">
				<include name="*.jar" />
				<exclude name="**/*.svn" />
				<exclude name="**/ant.jar" />
				<exclude name="**/derby.jar" />
				<exclude name="**/jasperreports.jar" />
				<exclude name="**/itext.jar" />
				<exclude name="**/jfreechart.jar" />
			</fileset>
			<fileset dir="${hibernatelib.dir}">
				<include name="**/dom4j.jar" />
				<exclude name="**/*.svn" />
			</fileset>
		</copy>

		<!-- Tell OS the dir is an App -->
		<exec command="/Developer/Tools/SetFile -a B ${appdir}" />
		
	</target>

	<!-- *************************************************************
	     Schema Export (Doesn't work at the moment)
	     ************************************************************* -->
	<target name="schemaexport" description="Generates the database schema with hbm2ddl to a file" depends="">
			<taskdef name="schemaexport" classname="org.hibernate.tool.hbm2ddl.SchemaExportTask">
				<classpath refid="project.class.path" />
				</taskdef>
				<!-- Use the Hibernate configuration from source directory. -->
				 <schemaexport 
				
				     config="src/hibernate.cfg.xml"
				     quiet="yes"
				     text="no"
				     drop="no" 
				     delimiter=";"
			         output="${build.dir}/schema-export.sql"/>
	</target>
	<!-- *************************************************************
	     Build Empty Derby DB
	     ************************************************************* -->
	<target name="build-empty-derby-db">
		<!--
		<property name="current.classpath" refid="project.class.path"/>
		<echo level="info">
		   Classpath is :
		      ${current.classpath}
		   </echo>
		-->
		
		<java classname="edu.ku.brc.specify.tests.BuildSampleDatabase" fork="true">
		    <classpath refid="project.class.path" />
			<arg value="build_empty"/>
			<arg value="${derby.data.path}"/>
		</java>
	</target>
		
	<!-- *************************************************************
	     Build Help Index
	     ************************************************************* -->
	<target name="build-help-index">		
		<java classname="edu.ku.brc.util.HelpIndexer" fork="true">
		    <classpath refid="project.class.path" />
			<arg value="${appdir}/help/SpecifyHelp.jhm"/>
			<arg value="${appdir}/help/SpecifyHelp"/>
			<arg value="${appdir}/help/SpecifyHelpIndex.xml"/>
		</java>
	</target>
	

	<!-- *************************************************************
	     Build Help FullText Index
	     ************************************************************* -->
	
	<target name="delete-config-files">
		  <delete file="${appdir}/help/${dist-linux}SearchConfig.txt"/>		
		  <delete file="${appdir}/help/${dist-mac}SearchConfig.txt"/>		
		  <delete file="${appdir}/help/${dist-win}SearchConfig.txt"/>		
	</target>

	<target name="build-help-fulltext-linux">
	  <java jar="${javahelp-home}/javahelp/bin/jhindexer.jar" fork="true" dir="${appdir}/help/">
	  	<!-- if definitions for dist-linux,dist-mac, or dist-win change then
	  		contents of xxxSearchConfig.txt files will need to be changed accordingly -->
	  	<arg value="-c" />
	  	<arg value="${dist-linux}SearchConfig.txt"/>
	  	<arg value="-db" />
	  	<arg value="SpecifyHelpSearchIndex"/>
	    <arg value="SpecifyHelp"/>
	  </java>
		<antcall target="delete-config-files"/>
	</target>
	
	<target name="build-help-fulltext-mac">
	  <java jar="${javahelp-home-mac}/javahelp/bin/jhindexer.jar" fork="true">
	  	<!-- if definitions for dist-linux,dist-mac, or dist-win change then
	  		contents of xxxSearchConfig.txt files will need to be changed accordingly -->
	  	<arg value="-c" />
	  	<arg value="${installer.dir}/help/${dist-mac}SearchConfig.txt"/>
	  	<arg value="-db" />
	  	<arg value="${installer.dir}/help/SpecifyHelpSearchIndex"/>
	    <arg value="${installer.dir}/help/SpecifyHelp"/>
	  </java>
		<antcall target="delete-config-files"/>
	</target>
	
	<target name="build-help-fulltext-win">
	  <java jar="${javahelp-home}/javahelp/bin/jhindexer.jar" fork="true" dir="${appdir}/help/">
	  	<!-- if definitions for dist-linux,dist-mac, or dist-win change then
	  		contents of xxxSearchConfig.txt files will need to be changed accordingly -->
	  	<arg value="-c" />
	  	<arg value="${installer.dir}SearchConfig.txt"/>
	  	<arg value="-db" />
	  	<arg value="SpecifyHelpSearchIndex"/>
	    <arg value="SpecifyHelp"/>
	  </java>
		<antcall target="delete-config-files"/>
	</target>
	
	<!-- *************************************************************
	     Common files between Windows and Linux
	     ************************************************************* -->
	<target name="basic-non-mac-dist">

		<mkdir dir="${appdir}/classes" />
		<copy file="${source.root}/log4j.properties" todir="${appdir}/classes/." />
		
		<!-- Copy config dir -->
		<copy todir="${appdir}/config">
			<fileset dir="config">
				<exclude name="**/.svn" />
				<exclude name="**/.csv" />
			</fileset>
		</copy>
		
		<!-- Copy demo_files dir -->
		<copy todir="${appdir}/demo_files">
			<fileset dir="demo_files">
				<exclude name="**/.svn" />
				<exclude name="**/.csv" />
				<exclude name="**/.jrxml" />
				<include name="**/topbrc195x68.png" />
				<include name="**/Stratigraphy.csv" />
			</fileset>
		</copy>
		
		<!-- Copy the main app jar -->
		<copy file="${jar.name}.jar" todir="${appdir}/libs" />

		<copy todir="${appdir}/libs">
			<fileset dir="libs">
				<include name="*.jar" />
				<exclude name="**/json-lib.jar" />
				<exclude name="**/ezmorph.jar" />
			</fileset>
			<fileset dir="${hibernatelib.dir}">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${ireport.dir}">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${system.dep.libs.dir}">
				<include name="*.jar" />
			</fileset>
		</copy>

		<!-- Copy Help -->
		<copy todir="${appdir}/help">
			<fileset dir="help">
				<exclude name="**/.svn" />
			</fileset>
		</copy>

	</target>

	<!-- *************************************************************
	     Windows Distribution
	     ************************************************************* -->
	
	<target name="dist-win-update" description="Updates the Specify.jat, images, help etc.">
		<property name="appdir" value="${dist-win}/Specify" />
		<property name="derby.data.path" value="${dist-win}/DerbyDatabases" />
		<antcall target="clean-jar"/>
		<antcall target="dist-jar"/>
		<antcall target="basic-non-mac-dist"/>
		<!-- Copy Alt Help Image Files -->
        <property name="alt.help.img.dir" value="AltHelpImages/Windows"/>
        <antcall target="copy-alt-help-images"/>
    </target>
	
	<target name="dist-win" description="Builds for Windows">
		
		<property name="appdir" value="${dist-win}/Specify" />
		<property name="derby.data.path" value="${dist-win}/DerbyDatabases" />
		
		<antcall target="clean-jar"/>
		<antcall target="dist-win-clean"/>
		<antcall target="dist-jar"/>
		
		<mkdir dir="${dist-win}" />
		<mkdir dir="${appdir}/libs" />
		<mkdir dir="${dist-win}/examples" />
		
		<!-- <antcall target="build-empty-derby-db"/> -->
		<antcall target="basic-non-mac-dist"/>

		<antcall target="build-help-index"/>
		<antcall target="build-help-fulltext-win"/>

		<!-- Copy Alt Help Image Files -->
		<property name="alt.help.img.dir" value="AltHelpImages/Windows"/>
	    <antcall target="copy-alt-help-images"/>
		
		<!-- Demo Files -->
		<copy file="demo_files/workbench/FishCollectingTrip.csv" todir="${dist-win}/examples" />
		<copy file="demo_files/workbench/JohsonCountyTrip.csv" todir="${dist-win}/examples" />
	    <copy file="demo_files/workbench/SaipanTrip.xls" todir="${dist-win}/examples" />
		<copy file="demo_files/Reports/ImportExample.jrxml" todir="${dist-win}/examples" />
		
		<!-- This is NOT for the release -->
		<!-- Copy demo_files dir -->
		<copy todir="${appdir}/demo_files">
			<fileset dir="demo_files">
				<exclude name="**/.svn" />
				<exclude name="**/.csv" />
				<exclude name="**/.jrxml" />
				<include name="**/*.jpg" />
			</fileset>
		</copy>

	</target>

	<target name="dist-win-jar">
		
		<property name="appdir" value="${dist-win}/Specify" />
		<property name="derby.data.path" value="${dist-win}/DerbyDatabases" />
		
		<antcall target="clean-jar"/>
		<antcall target="dist-jar"/>
		
		<copy file="${jar.name}.jar" todir="${appdir}/libs" />
		
	</target>

	<!-- *************************************************************
	     Linux Distribution
	     ************************************************************* -->
	<target name="dist-linux">
		
		<property name="appdir" value="${dist-linux}/Specify" />
		<property name="derby.data.path" value="${dist-linux}/DerbyDatabases" />
		
		<antcall target="clean-jar"/>
		
		<antcall target="dist-linux-clean"/>
		
	    <antcall target="dist-jar"/>
		
		
		<mkdir dir="${dist-linux}" />
		<mkdir dir="${appdir}/libs" />

		
		<antcall target="build-empty-derby-db"/>
		
		<antcall target="basic-non-mac-dist"/>
		
		<antcall target="build-help-index"/>
		<antcall target="build-help-fulltext-linux"/>

		<!-- Copy Alt Help Image Files -->
		<property name="alt.help.img.dir" value="AltHelpImages/Windows"/>
	    <antcall target="copy-alt-help-images"/>
				
		
		<!-- Copy info list -->
		<copy file="${packaging}/linux/specify.sh" todir="${dist-linux}/." />
		<chmod file="${dist-linux}/specify.sh" perm="u+rx"/>
		
		<copy file="${packaging}/linux/specifybuilder.sh" todir="${dist-linux}/." />
		<chmod file="${dist-linux}/specifybuilder.sh" perm="u+rx"/>
		
		<copy file="${packaging}/linux/specifydbinit.sh" todir="${dist-linux}/." />
		<chmod file="${dist-linux}/specifydbinit.sh" perm="u+rx"/>
		
		<copy file="${packaging}/linux/specifyschema.sh" todir="${dist-linux}/." />
		<chmod file="${dist-linux}/specifyschema.sh" perm="u+rx"/>

		<copy file="${packaging}/linux/ireportlaunch.sh" todir="${dist-linux}/." />
		<chmod file="${dist-linux}/ireportlaunch" perm="u+rx"/>

		<!-- Demo Files -->
		<copy file="demo_files/workbench/FishCollectingTrip.csv" todir="${dist-linux}/examples" />
		<copy file="demo_files/workbench/JohsonCountyTrip.csv" todir="${dist-linux}/examples" />
	    <copy file="demo_files/workbench/SaipanTrip.xls" todir="${dist-linux}/examples" />
		<copy file="demo_files/Reports/ImportExample.jrxml" todir="${dist-linux}/examples" />
		
	</target>
	
	<!--*************************************************************
	     Copy Alternate Help Images
	    ************************************************************* -->
	<target name="copy-alt-help-images">
		
		<!-- <property name="appdir" value="${dist-mac}/${app.name}.app" />
		<property name="alt.help.img.dir" value="AltHelpImages/Windows"/>
		<copy todir="${appdir}/Contents/Resources/Java/help/SpecifyHelp/images" flatten="true" overwrite="true"> -->
		<copy todir="${appdir}/help/SpecifyHelp/images" flatten="true" overwrite="true">
			<fileset dir="${alt.help.img.dir}">
				<exclude name="**/.svn" />
				<include name="**/*.png" />
			</fileset>
		</copy>
		
	</target>



	<!--*************************************************************
	     Clean Distributions
	    ************************************************************* -->
	<target name="dist-mac-clean">
		<delete dir="${dist-mac}"/>
    </target>
	
	<target name="dist-win-clean">
		<delete dir="${dist-win}"/>
    </target>
	
	<target name="dist-linux-clean">
		<delete dir="${dist-linux}"/>
    </target>
	
</project>
